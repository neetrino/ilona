---
description: –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ REST endpoints –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º.
globs: ["**/api/**", "**/*.controller.ts", "**/routes/**"]
alwaysApply: false
---

# –ü–†–ê–í–ò–õ–ê –ü–†–û–ï–ö–¢–ò–†–û–í–ê–ù–ò–Ø API

> RESTful, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API.

---

## üéØ –ì–õ–ê–í–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

1. **REST –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî —Ä–µ—Å—É—Ä—Å—ã –∏ HTTP –º–µ—Ç–æ–¥—ã
2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–µ–∑–¥–µ
3. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî /api/v1/...
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî OpenAPI/Swagger

---

## üîó URL –°–¢–†–£–ö–¢–£–†–ê

### –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

```
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
GET    /api/v1/products          # –°–ø–∏—Å–æ–∫
GET    /api/v1/products/:id      # –û–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç
POST   /api/v1/products          # –°–æ–∑–¥–∞—Ç—å
PUT    /api/v1/products/:id      # –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
PATCH  /api/v1/products/:id      # –û–±–Ω–æ–≤–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ
DELETE /api/v1/products/:id      # –£–¥–∞–ª–∏—Ç—å

# –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
GET    /api/v1/orders/:orderId/items
POST   /api/v1/orders/:orderId/items

# –î–µ–π—Å—Ç–≤–∏—è (–∫–æ–≥–¥–∞ –Ω–µ CRUD)
POST   /api/v1/orders/:id/cancel
POST   /api/v1/orders/:id/refund
POST   /api/v1/auth/login
POST   /api/v1/auth/logout

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
GET    /api/v1/getProducts       # –ì–ª–∞–≥–æ–ª –≤ URL
POST   /api/v1/createProduct     # –ì–ª–∞–≥–æ–ª –≤ URL
GET    /api/v1/product           # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ
DELETE /api/v1/products/delete/1 # –õ–∏—à–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç
```

### Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```
# –ü–∞–≥–∏–Ω–∞—Ü–∏—è
GET /api/v1/products?page=1&limit=20

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
GET /api/v1/products?sort=price&order=asc
GET /api/v1/products?sort=-createdAt  # –ú–∏–Ω—É—Å = DESC

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
GET /api/v1/products?category=electronics&minPrice=1000&maxPrice=5000

# –ü–æ–∏—Å–∫
GET /api/v1/products?search=iphone

# –í–∫–ª—é—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π
GET /api/v1/products?include=category,variants

# –í—ã–±–æ—Ä –ø–æ–ª–µ–π
GET /api/v1/products?fields=id,name,price
```

---

## üì§ –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (–µ–¥–∏–Ω–∏—á–Ω—ã–π –æ–±—ä–µ–∫—Ç)

```json
{
  "data": {
    "id": "clx123abc",
    "name": "iPhone 15",
    "price": 99900,
    "category": {
      "id": "clx456def",
      "name": "–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã"
    },
    "createdAt": "2024-01-15T10:30:00Z",
    "updatedAt": "2024-01-15T10:30:00Z"
  }
}
```

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (—Å–ø–∏—Å–æ–∫)

```json
{
  "data": [
    { "id": "clx123abc", "name": "iPhone 15" },
    { "id": "clx456def", "name": "Samsung S24" }
  ],
  "meta": {
    "total": 150,
    "page": 1,
    "limit": 20,
    "totalPages": 8,
    "hasNextPage": true,
    "hasPrevPage": false
  }
}
```

### –û—Ç–≤–µ—Ç –æ–± –æ—à–∏–±–∫–µ (RFC 7807)

```json
{
  "type": "https://api.example.com/errors/validation",
  "title": "Validation Error",
  "status": 400,
  "detail": "One or more fields have invalid values",
  "instance": "/api/v1/products",
  "errors": [
    {
      "field": "price",
      "code": "INVALID_VALUE",
      "message": "Price must be a positive number"
    },
    {
      "field": "name",
      "code": "REQUIRED",
      "message": "Name is required"
    }
  ],
  "timestamp": "2024-01-15T10:30:00Z",
  "traceId": "abc-123-def"
}
```

---

## üìä HTTP –°–¢–ê–¢–£–° –ö–û–î–´

### –£—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (2xx)

| –ö–æ–¥ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----|-------------------|
| 200 OK | GET, PUT, PATCH —É—Å–ø–µ—à–Ω–æ |
| 201 Created | POST —Å–æ–∑–¥–∞–ª —Ä–µ—Å—É—Ä—Å |
| 204 No Content | DELETE —É—Å–ø–µ—à–Ω–æ, –Ω–µ—Ç —Ç–µ–ª–∞ |

### –û—à–∏–±–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ (4xx)

| –ö–æ–¥ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----|-------------------|
| 400 Bad Request | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| 401 Unauthorized | –ù–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω |
| 403 Forbidden | –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ |
| 404 Not Found | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| 409 Conflict | –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–¥—É–±–ª–∏–∫–∞—Ç) |
| 422 Unprocessable | –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ |
| 429 Too Many Requests | Rate limit |

### –û—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (5xx)

| –ö–æ–¥ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----|-------------------|
| 500 Internal Server Error | –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ |
| 502 Bad Gateway | –û—à–∏–±–∫–∞ upstream —Å–µ—Ä–≤–∏—Å–∞ |
| 503 Service Unavailable | –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω |

---

## üîê –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø

### JWT Bearer Token

```http
# –ó–∞–ø—Ä–æ—Å
POST /api/v1/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "secret"
}

# –û—Ç–≤–µ—Ç
{
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "expiresIn": 3600,
    "tokenType": "Bearer"
  }
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
GET /api/v1/products
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
```

### Refresh Token

```http
POST /api/v1/auth/refresh
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
}
```

---

## üìù –í–ê–õ–ò–î–ê–¶–ò–Ø –í–•–û–î–ù–´–• –î–ê–ù–ù–´–•

### DTO —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

```typescript
// dto/create-product.dto.ts
import { 
  IsString, 
  IsNumber, 
  IsOptional, 
  Min, 
  Max,
  MaxLength,
  IsUUID,
  IsUrl,
  IsArray,
  ValidateNested,
  ArrayMinSize,
} from 'class-validator';
import { Type } from 'class-transformer';
import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';

export class CreateProductDto {
  @ApiProperty({ 
    description: '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞',
    example: 'iPhone 15 Pro',
    maxLength: 255,
  })
  @IsString()
  @MaxLength(255)
  name: string;

  @ApiPropertyOptional({ 
    description: '–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞',
    example: '–ù–æ–≤—ã–π iPhone —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–∞–º–µ—Ä–æ–π...',
  })
  @IsOptional()
  @IsString()
  @MaxLength(5000)
  description?: string;

  @ApiProperty({ 
    description: '–¶–µ–Ω–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö',
    example: 9990000,
    minimum: 0,
  })
  @IsNumber()
  @Min(0)
  price: number;

  @ApiProperty({ 
    description: 'ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
    example: 'clx123abc',
  })
  @IsUUID()
  categoryId: string;

  @ApiPropertyOptional({ 
    description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    type: [String],
  })
  @IsOptional()
  @IsArray()
  @IsUrl({}, { each: true })
  images?: string[];

  @ApiPropertyOptional({ 
    description: '–í–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ–¥—É–∫—Ç–∞',
    type: [CreateVariantDto],
  })
  @IsOptional()
  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => CreateVariantDto)
  @ArrayMinSize(1)
  variants?: CreateVariantDto[];
}
```

### –û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```json
{
  "type": "https://api.example.com/errors/validation",
  "title": "Validation Error",
  "status": 400,
  "detail": "Request body validation failed",
  "errors": [
    {
      "field": "price",
      "code": "MIN",
      "message": "price must not be less than 0",
      "value": -100
    },
    {
      "field": "name",
      "code": "MAX_LENGTH",
      "message": "name must be shorter than or equal to 255 characters",
      "value": "very long name..."
    }
  ]
}
```

---

## üìñ SWAGGER –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

```typescript
@Controller('products')
@ApiTags('Products')
@ApiBearerAuth()
export class ProductsController {
  
  @Get()
  @ApiOperation({ 
    summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
    description: '–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π',
  })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'limit', required: false, type: Number })
  @ApiQuery({ name: 'category', required: false, type: String })
  @ApiResponse({ 
    status: 200, 
    description: '–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
    type: PaginatedProductsResponse,
  })
  async findAll(@Query() query: ProductQueryDto) {
    return this.productsService.findAll(query);
  }

  @Get(':id')
  @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –ø–æ ID' })
  @ApiParam({ name: 'id', description: 'ID –ø—Ä–æ–¥—É–∫—Ç–∞' })
  @ApiResponse({ status: 200, description: '–ü—Ä–æ–¥—É–∫—Ç', type: Product })
  @ApiResponse({ status: 404, description: '–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' })
  async findOne(@Param('id', ParseUUIDPipe) id: string) {
    return this.productsService.findOne(id);
  }

  @Post()
  @UseGuards(JwtAuthGuard, RolesGuard)
  @Roles('admin')
  @ApiOperation({ summary: '–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç' })
  @ApiBody({ type: CreateProductDto })
  @ApiResponse({ status: 201, description: '–ü—Ä–æ–¥—É–∫—Ç —Å–æ–∑–¥–∞–Ω', type: Product })
  @ApiResponse({ status: 400, description: '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏' })
  @ApiResponse({ status: 401, description: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' })
  @ApiResponse({ status: 403, description: '–ù–µ—Ç –ø—Ä–∞–≤' })
  async create(
    @Body() dto: CreateProductDto,
    @CurrentUser() user: User,
  ) {
    return this.productsService.create(dto, user);
  }
}
```

---

## üîÑ –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï

### URL –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```
/api/v1/products
/api/v2/products
```

### –ü—Ä–∞–≤–∏–ª–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
// ‚úÖ –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–≥–¥–∞:
// - Breaking changes –≤ –æ—Ç–≤–µ—Ç–µ
// - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
// - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π
// - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è

// ‚ùå –ù–ï –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–≥–¥–∞:
// - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
// - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö endpoints
// - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤
// - –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–µ—Ä—Å–∏–π

```typescript
// Deprecation header
app.use('/api/v1/*', (req, res, next) => {
  res.setHeader('Deprecation', 'true');
  res.setHeader('Sunset', 'Sat, 01 Jan 2025 00:00:00 GMT');
  res.setHeader('Link', '</api/v2>; rel="successor-version"');
  next();
});
```

---

## ‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### Rate Limiting

```typescript
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π rate limit
@Module({
  imports: [
    ThrottlerModule.forRoot({
      ttl: 60,       // –û–∫–Ω–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
      limit: 100,    // –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–∫–Ω–µ
    }),
  ],
})
export class AppModule {}

// Per-endpoint
@Throttle(10, 60) // 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
@Post('login')
async login() { ... }
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
// Cache-Control –∑–∞–≥–æ–ª–æ–≤–∫–∏
@Get('products')
@Header('Cache-Control', 'public, max-age=300') // 5 –º–∏–Ω—É—Ç
async findAll() { ... }

// ETags
@Get('products/:id')
async findOne(@Param('id') id: string, @Res() res: Response) {
  const product = await this.service.findOne(id);
  const etag = generateEtag(product);
  
  res.setHeader('ETag', etag);
  res.json({ data: product });
}
```

### –ö–æ–º–ø—Ä–µ—Å—Å–∏—è

```typescript
// main.ts
import compression from 'compression';

app.use(compression());
```

---

## üîî WEBHOOKS

### –û—Ç–ø—Ä–∞–≤–∫–∞ webhooks

```typescript
// services/webhook.service.ts
@Injectable()
export class WebhookService {
  private readonly logger = new Logger(WebhookService.name);

  async send(
    url: string,
    event: string,
    payload: unknown,
    secret: string,
  ): Promise<void> {
    const timestamp = Date.now();
    const body = JSON.stringify({
      event,
      timestamp,
      data: payload,
    });

    // –ü–æ–¥–ø–∏—Å—å –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
    const signature = this.createSignature(body, secret, timestamp);

    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Webhook-Signature': signature,
          'X-Webhook-Timestamp': timestamp.toString(),
          'X-Webhook-Event': event,
        },
        body,
        signal: AbortSignal.timeout(10000), // 10s timeout
      });

      if (!response.ok) {
        throw new Error(`Webhook failed: ${response.status}`);
      }

      this.logger.log(`Webhook sent: ${event} to ${url}`);
    } catch (error) {
      this.logger.error(`Webhook failed: ${event} to ${url}`, error);
      // –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è retry
      await this.queueRetry(url, event, payload, secret);
    }
  }

  private createSignature(
    body: string,
    secret: string,
    timestamp: number,
  ): string {
    const payload = `${timestamp}.${body}`;
    return crypto
      .createHmac('sha256', secret)
      .update(payload)
      .digest('hex');
  }

  private async queueRetry(...args: unknown[]) {
    // –î–æ–±–∞–≤–∏—Ç—å –≤ BullMQ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
  }
}
```

### –ü—Ä–∏—ë–º webhooks

```typescript
// controllers/webhook.controller.ts
@Controller('webhooks')
export class WebhookController {
  
  @Post('stripe')
  async handleStripe(
    @Body() body: unknown,
    @Headers('stripe-signature') signature: string,
  ) {
    // –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏
    const event = this.verifyStripeSignature(body, signature);
    
    // –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏
    const processed = await this.cache.get(`webhook:${event.id}`);
    if (processed) {
      return { received: true, duplicate: true };
    }
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
    await this.processEvent(event);
    
    // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π
    await this.cache.set(`webhook:${event.id}`, true, 86400 * 7); // 7 –¥–Ω–µ–π
    
    return { received: true };
  }
}
```

### –ü—Ä–∞–≤–∏–ª–∞ Webhooks

```markdown
## –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ webhooks

### –ü–æ–¥–ø–∏—Å—å
- ‚úÖ HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
- ‚úÖ Timestamp –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç replay attacks
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∏

### Retry —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- ‚úÖ Exponential backoff: 1m, 5m, 30m, 2h, 24h
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 5-10 –ø–æ–ø—ã—Ç–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏
- ‚úÖ –£–≤–µ–¥–æ–º–ª—è—Ç—å –ø—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –æ—Ç–∫–∞–∑–µ

### Payload
- ‚úÖ –ú–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö (id + event type)
- ‚úÖ –ü–æ–ª—É—á–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ API
- ‚úÖ –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## –ü—Ä–∏ –ø—Ä–∏—ë–º–µ webhooks

### –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å—å
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å timestamp (–Ω–µ —Å—Ç–∞—Ä—à–µ 5 –º–∏–Ω—É—Ç)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS only

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å ID –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—å ID –º–∏–Ω–∏–º—É–º 7 –¥–Ω–µ–π

### –û–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–æ –≤–µ—Ä–Ω—É—Ç—å 200 (< 3 —Å–µ–∫—É–Ω–¥)
- ‚úÖ –¢—è–∂—ë–ª—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É ‚Äî –≤ –æ—á–µ—Ä–µ–¥—å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è
```

### –§–æ—Ä–º–∞—Ç Webhook —Å–æ–±—ã—Ç–∏—è

```json
{
  "id": "evt_123abc",
  "event": "order.completed",
  "timestamp": 1705312800000,
  "data": {
    "orderId": "ord_456def",
    "status": "completed"
  }
}
```

---

## üìã CHECKLIST

### –ù–æ–≤—ã–π endpoint

- [ ] RESTful URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π HTTP –º–µ—Ç–æ–¥
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∫–æ–¥
- [ ] DTO —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [ ] Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] Rate limiting (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### API Review

- [ ] –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ endpoints
- [ ] –ù–µ—Ç breaking changes
- [ ] –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Webhooks (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

- [ ] –ü–æ–¥–ø–∏—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (HMAC-SHA256)
- [ ] Retry —Å exponential backoff
- [ ] –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø—Ä–∏—ë–º–µ
- [ ] Timestamp –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π

---

**–í–µ—Ä—Å–∏—è:** 1.1
**–î–∞—Ç–∞:** 2025-01-31
