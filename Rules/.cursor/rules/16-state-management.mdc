---
description: –ü—Ä–∞–≤–∏–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º. Server state, Client state, Form state, URL state.
globs: ["**/*.tsx", "**/hooks/**", "**/store/**", "**/features/**"]
alwaysApply: false
---

# –ü–†–ê–í–ò–õ–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–û–°–¢–û–Ø–ù–ò–ï–ú

> –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ. –ù–µ –≤—Å—ë –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Å—Ç–æ—Ä–µ.

---

## üéØ –ì–õ–ê–í–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

1. **–ú–∏–Ω–∏–º—É–º —Å–æ—Å—Ç–æ—è–Ω–∏—è** ‚Äî derive –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ
2. **Colocation** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–∏–∂–µ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
3. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤** ‚Äî server state ‚â† client state
4. **Single Source of Truth** ‚Äî –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã

---

## üìä –¢–ò–ü–´ –°–û–°–¢–û–Ø–ù–ò–Ø

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –¢–ò–ü–´ –°–û–°–¢–û–Ø–ù–ò–Ø                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  SERVER STATE   ‚îÇ  CLIENT STATE   ‚îÇ     FORM STATE          ‚îÇ
‚îÇ                 ‚îÇ                 ‚îÇ                         ‚îÇ
‚îÇ  –î–∞–Ω–Ω—ã–µ —Å API   ‚îÇ  UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ   ‚îÇ  –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã           ‚îÇ
‚îÇ  React Query    ‚îÇ  Zustand        ‚îÇ  React Hook Form        ‚îÇ
‚îÇ  SWR            ‚îÇ  Context        ‚îÇ  Formik                 ‚îÇ
‚îÇ                 ‚îÇ  useState       ‚îÇ                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                       URL STATE                             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  –§–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞                         ‚îÇ
‚îÇ  useSearchParams, nuqs                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üåê SERVER STATE (React Query)

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –î–∞–Ω–Ω—ã–µ —Å API/backend
- –î–∞–Ω–Ω—ã–µ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å
- –î–∞–Ω–Ω—ã–µ –∫–æ—Ç–æ—Ä—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏

### –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```typescript
// lib/query-client.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60,        // 1 –º–∏–Ω—É—Ç–∞ ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–µ
      gcTime: 1000 * 60 * 5,       // 5 –º–∏–Ω—É—Ç ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à–µ
      retry: 1,                    // 1 —Ä–µ—Ç—Ä–∞–π –Ω–∞ –æ—à–∏–±–∫—É
      refetchOnWindowFocus: false, // –ù–µ —Ä–µ—Ñ–µ—Ç—á–∏—Ç—å –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
    },
    mutations: {
      retry: 0,
    },
  },
});
```

### Query Hooks

```typescript
// features/products/hooks/useProducts.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { productApi } from '../api/productApi';
import type { ProductFilters, CreateProductDTO } from '../types';

// Query Keys ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ
export const productKeys = {
  all: ['products'] as const,
  lists: () => [...productKeys.all, 'list'] as const,
  list: (filters: ProductFilters) => [...productKeys.lists(), filters] as const,
  details: () => [...productKeys.all, 'detail'] as const,
  detail: (id: string) => [...productKeys.details(), id] as const,
};

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
export function useProducts(filters: ProductFilters) {
  return useQuery({
    queryKey: productKeys.list(filters),
    queryFn: () => productApi.getList(filters),
    // Placeholder –ø–æ–∫–∞ –≥—Ä—É–∑–∏—Ç—Å—è
    placeholderData: (previousData) => previousData,
  });
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
export function useProduct(id: string) {
  return useQuery({
    queryKey: productKeys.detail(id),
    queryFn: () => productApi.getById(id),
    enabled: !!id, // –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç id
  });
}

// –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
export function useCreateProduct() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: (data: CreateProductDTO) => productApi.create(data),
    onSuccess: () => {
      // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–ø–∏—Å–∫–∏
      queryClient.invalidateQueries({ queryKey: productKeys.lists() });
    },
  });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
export function useUpdateProduct() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdateProductDTO }) => 
      productApi.update(id, data),
    onSuccess: (updatedProduct) => {
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      queryClient.setQueryData(
        productKeys.detail(updatedProduct.id),
        updatedProduct
      );
      // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–ø–∏—Å–∫–∏
      queryClient.invalidateQueries({ queryKey: productKeys.lists() });
    },
  });
}

// –£–¥–∞–ª–µ–Ω–∏–µ
export function useDeleteProduct() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: (id: string) => productApi.delete(id),
    onSuccess: (_, deletedId) => {
      // –£–¥–∞–ª—è–µ–º –∏–∑ –∫—ç—à–∞
      queryClient.removeQueries({ queryKey: productKeys.detail(deletedId) });
      // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–ø–∏—Å–∫–∏
      queryClient.invalidateQueries({ queryKey: productKeys.lists() });
    },
  });
}
```

### Optimistic Updates

```typescript
export function useToggleFavorite() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: (productId: string) => productApi.toggleFavorite(productId),
    
    // Optimistic update
    onMutate: async (productId) => {
      // –û—Ç–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
      await queryClient.cancelQueries({ queryKey: productKeys.detail(productId) });
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
      const previousProduct = queryClient.getQueryData(
        productKeys.detail(productId)
      );
      
      // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º
      queryClient.setQueryData(
        productKeys.detail(productId),
        (old: Product) => ({
          ...old,
          isFavorite: !old.isFavorite,
        })
      );
      
      return { previousProduct };
    },
    
    // –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
    onError: (err, productId, context) => {
      queryClient.setQueryData(
        productKeys.detail(productId),
        context?.previousProduct
      );
    },
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–∏
    onSettled: (_, __, productId) => {
      queryClient.invalidateQueries({ queryKey: productKeys.detail(productId) });
    },
  });
}
```

---

## üè† CLIENT STATE (Zustand)

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Ç–µ–º–∞, sidebar –æ—Ç–∫—Ä—ã—Ç)
- –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫
- –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –ù–ï —Å —Å–µ—Ä–≤–µ—Ä–∞

### –ë–∞–∑–æ–≤—ã–π store

```typescript
// store/useCartStore.ts
import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';

interface CartItem {
  productId: string;
  name: string;
  price: number;
  quantity: number;
}

interface CartState {
  items: CartItem[];
  isOpen: boolean;
}

interface CartActions {
  addItem: (item: Omit<CartItem, 'quantity'>) => void;
  removeItem: (productId: string) => void;
  updateQuantity: (productId: string, quantity: number) => void;
  clearCart: () => void;
  toggleCart: () => void;
}

export const useCartStore = create<CartState & CartActions>()(
  persist(
    immer((set) => ({
      // State
      items: [],
      isOpen: false,

      // Actions
      addItem: (item) =>
        set((state) => {
          const existingItem = state.items.find(
            (i) => i.productId === item.productId
          );
          
          if (existingItem) {
            existingItem.quantity += 1;
          } else {
            state.items.push({ ...item, quantity: 1 });
          }
        }),

      removeItem: (productId) =>
        set((state) => {
          state.items = state.items.filter((i) => i.productId !== productId);
        }),

      updateQuantity: (productId, quantity) =>
        set((state) => {
          const item = state.items.find((i) => i.productId === productId);
          if (item) {
            if (quantity <= 0) {
              state.items = state.items.filter((i) => i.productId !== productId);
            } else {
              item.quantity = quantity;
            }
          }
        }),

      clearCart: () =>
        set((state) => {
          state.items = [];
        }),

      toggleCart: () =>
        set((state) => {
          state.isOpen = !state.isOpen;
        }),
    })),
    {
      name: 'cart-storage',
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({ items: state.items }), // –¢–æ–ª—å–∫–æ items –≤ storage
    }
  )
);

// –°–µ–ª–µ–∫—Ç–æ—Ä—ã (–≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
export const useCartTotal = () =>
  useCartStore((state) =>
    state.items.reduce((sum, item) => sum + item.price * item.quantity, 0)
  );

export const useCartItemCount = () =>
  useCartStore((state) =>
    state.items.reduce((sum, item) => sum + item.quantity, 0)
  );
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```tsx
// components/CartButton.tsx
'use client';

import { useCartStore, useCartItemCount } from '@/store/useCartStore';

export function CartButton() {
  const toggleCart = useCartStore((state) => state.toggleCart);
  const itemCount = useCartItemCount();

  return (
    <button onClick={toggleCart} className="relative">
      <ShoppingCartIcon />
      {itemCount > 0 && (
        <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5">
          {itemCount}
        </span>
      )}
    </button>
  );
}
```

### Store –¥–ª—è UI —Å–æ—Å—Ç–æ—è–Ω–∏—è

```typescript
// store/useUIStore.ts
import { create } from 'zustand';

interface UIState {
  sidebarOpen: boolean;
  theme: 'light' | 'dark' | 'system';
  modalStack: string[];
}

interface UIActions {
  toggleSidebar: () => void;
  setTheme: (theme: UIState['theme']) => void;
  openModal: (modalId: string) => void;
  closeModal: (modalId?: string) => void;
}

export const useUIStore = create<UIState & UIActions>((set) => ({
  sidebarOpen: true,
  theme: 'system',
  modalStack: [],

  toggleSidebar: () =>
    set((state) => ({ sidebarOpen: !state.sidebarOpen })),

  setTheme: (theme) => set({ theme }),

  openModal: (modalId) =>
    set((state) => ({ modalStack: [...state.modalStack, modalId] })),

  closeModal: (modalId) =>
    set((state) => ({
      modalStack: modalId
        ? state.modalStack.filter((id) => id !== modalId)
        : state.modalStack.slice(0, -1),
    })),
}));
```

---

## üìù FORM STATE (React Hook Form)

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –õ—é–±—ã–µ —Ñ–æ—Ä–º—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º

### –ë–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º–∞

```tsx
// components/ProductForm.tsx
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

const productSchema = z.object({
  name: z.string().min(1, '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ').max(255),
  description: z.string().max(5000).optional(),
  price: z.number().min(0, '–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π'),
  categoryId: z.string().uuid('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é'),
  isActive: z.boolean().default(true),
});

type ProductFormData = z.infer<typeof productSchema>;

interface Props {
  defaultValues?: Partial<ProductFormData>;
  onSubmit: (data: ProductFormData) => Promise<void>;
}

export function ProductForm({ defaultValues, onSubmit }: Props) {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset,
  } = useForm<ProductFormData>({
    resolver: zodResolver(productSchema),
    defaultValues: {
      name: '',
      description: '',
      price: 0,
      isActive: true,
      ...defaultValues,
    },
  });

  const onSubmitHandler = async (data: ProductFormData) => {
    try {
      await onSubmit(data);
      reset();
    } catch (error) {
      // –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤—ã—à–µ
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmitHandler)} className="space-y-4">
      <div>
        <label htmlFor="name" className="block text-sm font-medium">
          –ù–∞–∑–≤–∞–Ω–∏–µ
        </label>
        <input
          {...register('name')}
          id="name"
          className="mt-1 block w-full rounded-md border p-2"
        />
        {errors.name && (
          <p className="mt-1 text-sm text-red-600">{errors.name.message}</p>
        )}
      </div>

      <div>
        <label htmlFor="price" className="block text-sm font-medium">
          –¶–µ–Ω–∞
        </label>
        <input
          {...register('price', { valueAsNumber: true })}
          id="price"
          type="number"
          className="mt-1 block w-full rounded-md border p-2"
        />
        {errors.price && (
          <p className="mt-1 text-sm text-red-600">{errors.price.message}</p>
        )}
      </div>

      <button
        type="submit"
        disabled={isSubmitting}
        className="w-full rounded-md bg-primary-600 py-2 text-white disabled:opacity-50"
      >
        {isSubmitting ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}
      </button>
    </form>
  );
}
```

### Form —Å React Query

```tsx
// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º—ã —Å –º—É—Ç–∞—Ü–∏–µ–π
export function CreateProductForm() {
  const createProduct = useCreateProduct();
  
  const handleSubmit = async (data: ProductFormData) => {
    await createProduct.mutateAsync(data);
  };
  
  return (
    <ProductForm 
      onSubmit={handleSubmit}
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
      serverError={createProduct.error?.message}
    />
  );
}
```

---

## üîó URL STATE

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ URL
- Shareable —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### useSearchParams (Next.js)

```tsx
// features/products/components/ProductFilters.tsx
'use client';

import { useRouter, useSearchParams, usePathname } from 'next/navigation';
import { useCallback } from 'react';

export function ProductFilters() {
  const router = useRouter();
  const pathname = usePathname();
  const searchParams = useSearchParams();
  
  // –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ URL
  const category = searchParams.get('category') ?? '';
  const sort = searchParams.get('sort') ?? 'createdAt';
  const page = Number(searchParams.get('page')) || 1;

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL
  const updateFilters = useCallback(
    (updates: Record<string, string | number | null>) => {
      const params = new URLSearchParams(searchParams.toString());
      
      Object.entries(updates).forEach(([key, value]) => {
        if (value === null || value === '') {
          params.delete(key);
        } else {
          params.set(key, String(value));
        }
      });
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
      if (!('page' in updates)) {
        params.delete('page');
      }
      
      router.push(`${pathname}?${params.toString()}`);
    },
    [router, pathname, searchParams]
  );

  return (
    <div className="flex gap-4">
      <select
        value={category}
        onChange={(e) => updateFilters({ category: e.target.value })}
      >
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        <option value="electronics">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
        <option value="clothing">–û–¥–µ–∂–¥–∞</option>
      </select>

      <select
        value={sort}
        onChange={(e) => updateFilters({ sort: e.target.value })}
      >
        <option value="createdAt">–ü–æ –¥–∞—Ç–µ</option>
        <option value="price">–ü–æ —Ü–µ–Ω–µ</option>
        <option value="name">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
      </select>
    </div>
  );
}
```

### nuqs (Type-safe URL state)

```tsx
// –ë–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å nuqs
import { useQueryState, parseAsInteger, parseAsString } from 'nuqs';

export function ProductFilters() {
  const [category, setCategory] = useQueryState('category');
  const [sort, setSort] = useQueryState('sort', parseAsString.withDefault('createdAt'));
  const [page, setPage] = useQueryState('page', parseAsInteger.withDefault(1));

  return (
    <div className="flex gap-4">
      <select
        value={category ?? ''}
        onChange={(e) => setCategory(e.target.value || null)}
      >
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        <option value="electronics">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
      </select>
      
      <Pagination
        currentPage={page}
        onPageChange={setPage}
      />
    </div>
  );
}
```

---

## üö´ –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù–´

### ‚ùå –ù–µ –¥–µ–ª–∞–π

```tsx
// ‚ùå Server data –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Å—Ç–æ—Ä–µ
const useStore = create((set) => ({
  products: [],
  fetchProducts: async () => {
    const products = await api.getProducts();
    set({ products });
  },
}));

// ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
const [localUser, setLocalUser] = useState(user); // user —É–∂–µ –µ—Å—Ç—å!

// ‚ùå Derived state –≤ useState
const [total, setTotal] = useState(0);
useEffect(() => {
  setTotal(items.reduce((sum, i) => sum + i.price, 0));
}, [items]);

// ‚ùå –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Å—Ç–æ—Ä–µ
const useStore = create((set) => ({
  user: null,
  products: [],
  orders: [],
  cart: [],
  notifications: [],
  // ... –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
}));
```

### ‚úÖ –î–µ–ª–∞–π

```tsx
// ‚úÖ Server data —á–µ—Ä–µ–∑ React Query
const { data: products } = useProducts();

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
<UserProfile user={user} />

// ‚úÖ Derive state
const total = items.reduce((sum, i) => sum + i.price, 0);

// ‚úÖ –†–∞–∑–¥–µ–ª—è–π —Å—Ç–æ—Ä—ã –ø–æ –¥–æ–º–µ–Ω–∞–º
const useCartStore = create(...);
const useUIStore = create(...);
const useAuthStore = create(...);
```

---

## üìã –í–´–ë–û–† –¢–ò–ü–ê –°–û–°–¢–û–Ø–ù–ò–Ø

```markdown
## –î–µ—Ä–µ–≤–æ —Ä–µ—à–µ–Ω–∏–π

–î–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞?
‚îú‚îÄ‚îÄ –î–∞ ‚Üí React Query / SWR
‚îî‚îÄ‚îÄ –ù–µ—Ç
    ‚îî‚îÄ‚îÄ –ù—É–∂–Ω–æ –≤ URL?
        ‚îú‚îÄ‚îÄ –î–∞ ‚Üí useSearchParams / nuqs
        ‚îî‚îÄ‚îÄ –ù–µ—Ç
            ‚îî‚îÄ‚îÄ –ù—É–∂–Ω–æ –≥–ª–æ–±–∞–ª—å–Ω–æ?
                ‚îú‚îÄ‚îÄ –î–∞ ‚Üí Zustand
                ‚îî‚îÄ‚îÄ –ù–µ—Ç
                    ‚îî‚îÄ‚îÄ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã?
                        ‚îú‚îÄ‚îÄ –î–∞ ‚Üí React Hook Form
                        ‚îî‚îÄ‚îÄ –ù–µ—Ç ‚Üí useState
```

---

## üìã CHECKLIST

### –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞

- [ ] Server state –≤ React Query
- [ ] Client state –≤ Zustand (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≥–ª–æ–±–∞–ª—å–Ω–æ)
- [ ] Form state –≤ React Hook Form
- [ ] URL state –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤/–ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- [ ] Derive state –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤

### React Query

- [ ] Query Keys —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] staleTime/gcTime –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Optimistic updates –≥–¥–µ –Ω—É–∂–Ω–æ
- [ ] Error handling –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### Zustand

- [ ] –°—Ç–æ—Ä—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –¥–æ–º–µ–Ω–∞–º
- [ ] persist –¥–ª—è –Ω—É–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è granular updates

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-01-31
